<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Theme Builder Pro - Fully Functional</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.2rem;
        }

        .stats-bar {
            background: #34495e;
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .icon {
            width: 28px;
            height: 28px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .structure-input {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
            background: #2d3748;
            color: #e2e8f0;
        }

        .structure-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .code-section {
            grid-column: 1 / -1;
            margin-top: 25px;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .file-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .file-header {
            padding: 15px 20px;
            border-bottom: 2px solid #f1f3f4;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        .file-path {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .php-file { background: #8892bf; }
        .css-file { background: #2196f3; }
        .js-file { background: #f7df1e; color: #000; }
        .html-file { background: #e34c26; }
        .default-file { background: #6c757d; }

        .line-counter {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #495057;
            min-width: 60px;
            text-align: center;
        }

        .file-textarea {
            width: 100%;
            border: none;
            padding: 20px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            min-height: 300px;
            background: #1a202c;
            color: #e2e8f0;
            line-height: 1.5;
        }

        .file-textarea:focus {
            outline: none;
            background: #2d3748;
        }

        .file-textarea::placeholder {
            color: #a0aec0;
            font-style: italic;
        }

        .controls {
            grid-column: 1 / -1;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .generate-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }

        .generate-btn:hover {
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
        }

        .download-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            font-size: 16px;
            padding: 18px 30px;
        }

        .download-btn:hover {
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .clear-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .clear-btn:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .preview-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .preview-btn:hover {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .progress {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s;
        }

        .status {
            text-align: center;
            margin: 15px 0;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .theme-info {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            border: 2px solid #27ae60;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .theme-info h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .info-input {
            display: flex;
            flex-direction: column;
        }

        .info-input label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .info-input input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .info-input input:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .tree-view {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-top: 15px;
            min-height: 100px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .file-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎬 WordPress Theme Builder Pro</h1>
            <p>Advanced theme development with intelligent structure parsing</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <span>📁</span>
                <span>Files: <span id="fileCount">0</span></span>
            </div>
            <div class="stat-item">
                <span>📝</span>
                <span>Total Lines: <span id="totalLines">0</span></span>
            </div>
            <div class="stat-item">
                <span>💾</span>
                <span>Size: <span id="totalSize">0 KB</span></span>
            </div>
        </div>

        <div class="main-content">
            <!-- Theme Information -->
            <div class="theme-info">
                <h3>📋 Theme Configuration</h3>
                <div class="info-grid">
                    <div class="info-input">
                        <label for="themeName">Theme Name</label>
                        <input type="text" id="themeName" placeholder="Movie Bursts Theme" value="Movie Bursts Theme">
                    </div>
                    <div class="info-input">
                        <label for="themeVersion">Version</label>
                        <input type="text" id="themeVersion" placeholder="1.0.0" value="1.0.0">
                    </div>
                    <div class="info-input">
                        <label for="themeAuthor">Author</label>
                        <input type="text" id="themeAuthor" placeholder="Your Name" value="Developer">
                    </div>
                    <div class="info-input">
                        <label for="themeDescription">Description</label>
                        <input type="text" id="themeDescription" placeholder="A WordPress theme for movie content" value="A modern WordPress theme for movie and entertainment websites">
                    </div>
                </div>
            </div>

            <!-- Structure Input -->
            <div class="section">
                <h2><span class="icon">🌳</span>Theme Structure</h2>
                <textarea class="structure-input" id="themeStructure" placeholder="Paste your theme structure here...">movie-bursts-theme/
├── style.css
├── functions.php
├── index.php
├── header.php
├── footer.php
├── page.php
├── single.php
├── archive.php
├── assets/
│   ├── js/
│   │   └── main.js
│   └── css/
│       └── main.css
└── template-parts/
    ├── content-home.php
    ├── content-genre.php
    ├── content-movies.php
    ├── content-streaming.php
    ├── content-tvshows.php
    └── content-tvshow-detail.php</textarea>
                <div class="tree-view" id="parsedStructure">Click "Parse Structure & Generate" to see parsed files here...</div>
            </div>

            <!-- Plugin Structure -->
            <div class="section">
                <h2><span class="icon">🔌</span>Plugin Structure (Optional)</h2>
                <textarea class="structure-input" id="pluginStructure" placeholder="Paste plugin structure here...
Example:
my-plugin/
├── my-plugin.php
├── includes/
│   └── functions.php
└── assets/
    ├── css/
    │   └── style.css
    └── js/
        └── script.js"></textarea>
            </div>

            <!-- Code Input Section -->
            <div class="code-section section">
                <h2><span class="icon">💻</span>Code Editor</h2>
                <div class="file-grid" id="fileGrid">
                    <div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;">
                        <h3>📄 No files generated yet</h3>
                        <p>Click "Parse Structure & Generate" to create file editors</p>
                    </div>
                </div>
                <div class="controls">
                    <button class="generate-btn" onclick="parseStructureAndGenerate()">
                        🔄 Parse Structure & Generate
                    </button>
                    <button class="preview-btn" onclick="previewStructure()">
                        👁️ Preview Structure
                    </button>
                    <button class="clear-btn" onclick="clearAll()">
                        🗑️ Clear All
                    </button>
                    <button class="download-btn" onclick="generateZip()">
                        📦 Build & Download Theme
                    </button>
                </div>
                <div class="progress" id="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="status" id="status">🚀 Ready to build your WordPress theme!</div>
            </div>
        </div>
    </div>

    <script>
        let fileInputs = {};
        let parsedFiles = [];

        function getFileIcon(filePath) {
            const ext = filePath.split('.').pop().toLowerCase();
            const iconMap = {
                'php': { class: 'php-file', icon: 'PHP' },
                'css': { class: 'css-file', icon: 'CSS' },
                'js': { class: 'js-file', icon: 'JS' },
                'html': { class: 'html-file', icon: 'HTML' },
                'htm': { class: 'html-file', icon: 'HTML' }
            };
            return iconMap[ext] || { class: 'default-file', icon: 'FILE' };
        }

        function parseTreeStructure(structureText) {
            console.log('Parsing structure:', structureText);
            const lines = structureText.split('\n').filter(line => line.trim());
            const files = [];
            const folderStack = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const originalLine = line;
                
                // Remove tree characters and get clean content
                const cleanLine = line.replace(/[├│└─┌┐┘┴┬┤┼┬┴┌┐└┘│─]+/g, '').replace(/\s+/g, ' ').trim();
                
                if (!cleanLine) continue;
                
                // Count the depth by counting spaces and tree characters before the content
                const beforeContent = line.substring(0, line.indexOf(cleanLine));
                const depth = beforeContent.length;
                
                if (cleanLine.endsWith('/')) {
                    // It's a folder
                    const folderName = cleanLine.replace('/', '');
                    
                    // Adjust folder stack based on depth
                    while (folderStack.length > 0 && folderStack[folderStack.length - 1].depth >= depth) {
                        folderStack.pop();
                    }
                    
                    folderStack.push({ name: folderName, depth: depth });
                } else {
                    // It's a file
                    let filePath = cleanLine;
                    
                    // Build the full path using the folder stack
                    if (folderStack.length > 0) {
                        const pathParts = [];
                        for (let folder of folderStack) {
                            if (folder.depth < depth) {
                                pathParts.push(folder.name);
                            }
                        }
                        if (pathParts.length > 0) {
                            filePath = pathParts.join('/') + '/' + cleanLine;
                        }
                    }
                    
                    files.push(filePath);
                }
            }
            
            console.log('Parsed files:', files);
            return files;
        }

        function parseStructureAndGenerate() {
            console.log('parseStructureAndGenerate called');
            const themeStructure = document.getElementById('themeStructure').value.trim();
            const pluginStructure = document.getElementById('pluginStructure').value.trim();
            
            if (!themeStructure) {
                updateStatus("❌ Please provide a theme structure first!");
                return;
            }

            try {
                const themeFiles = parseTreeStructure(themeStructure);
                const pluginFiles = pluginStructure ? parseTreeStructure(pluginStructure) : [];
                
                parsedFiles = [
                    ...themeFiles.map(file => ({ path: file, type: 'theme' })),
                    ...pluginFiles.map(file => ({ path: file, type: 'plugin' }))
                ];

                console.log('All parsed files:', parsedFiles);

                generateFileInputs();
                updateStats();
                previewStructure();
                updateStatus(`✅ Successfully generated ${parsedFiles.length} file editors!`);
            } catch (error) {
                console.error('Error parsing structure:', error);
                updateStatus("❌ Error parsing structure. Please check your format.");
            }
        }

        function generateFileInputs() {
            console.log('generateFileInputs called');
            const container = document.getElementById('fileGrid');
            container.innerHTML = '';
            fileInputs = {};

            if (parsedFiles.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;">
                        <h3>📄 No files to generate</h3>
                        <p>Please check your structure format</p>
                    </div>
                `;
                return;
            }

            parsedFiles.forEach((file, index) => {
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                
                const fileInfo = getFileIcon(file.path);
                const sanitizedId = file.path.replace(/[^a-zA-Z0-9]/g, '_') + '_' + index;
                
                fileCard.innerHTML = `
                    <div class="file-header">
                        <div class="file-path">
                            <div class="file-icon ${fileInfo.class}">${fileInfo.icon}</div>
                            <span>${file.path} ${file.type === 'plugin' ? '(Plugin)' : ''}</span>
                        </div>
                        <div class="line-counter" id="counter_${sanitizedId}">0 lines</div>
                    </div>
                    <textarea 
                        class="file-textarea" 
                        id="file_${sanitizedId}"
                        placeholder="Enter your ${fileInfo.icon} code here...

✨ This editor supports color coding
📝 Line count updates automatically  
💡 Tip: Use proper indentation for better readability

Start coding your ${file.path} file..."
                    ></textarea>
                `;
                
                container.appendChild(fileCard);
                
                const textarea = fileCard.querySelector('textarea');
                
                // Add event listener for line counting
                textarea.addEventListener('input', function() {
                    updateLineCount(sanitizedId);
                });
                
                fileInputs[file.path] = { element: textarea, type: file.type, id: sanitizedId };
            });

            console.log('Generated file inputs:', fileInputs);
        }

        function updateLineCount(fileId) {
            const textarea = document.getElementById(`file_${fileId}`);
            const counter = document.getElementById(`counter_${fileId}`);
            if (textarea && counter) {
                const lines = textarea.value.split('\n').length;
                counter.textContent = `${lines} line${lines !== 1 ? 's' : ''}`;
                updateStats();
            }
        }

        function updateStats() {
            const fileCount = Object.keys(fileInputs).length;
            let totalLines = 0;
            let totalSize = 0;

            for (const filePath in fileInputs) {
                const content = fileInputs[filePath].element.value;
                totalLines += content.split('\n').length;
                totalSize += new Blob([content]).size;
            }

            document.getElementById('fileCount').textContent = fileCount;
            document.getElementById('totalLines').textContent = totalLines;
            document.getElementById('totalSize').textContent = `${(totalSize / 1024).toFixed(1)} KB`;
        }

        function previewStructure() {
            console.log('previewStructure called');
            const preview = document.getElementById('parsedStructure');
            
            if (parsedFiles.length === 0) {
                preview.textContent = 'No structure parsed yet. Click "Parse Structure & Generate" first.';
                return;
            }

            let previewText = 'Parsed Structure:\n';
            previewText += '═══════════════════\n\n';
            
            parsedFiles.forEach((file, index) => {
                const icon = getFileIcon(file.path);
                previewText += `${index + 1}. 📄 ${file.path} (${icon.icon}) ${file.type === 'plugin' ? '[Plugin]' : '[Theme]'}\n`;
            });

            preview.textContent = previewText;
        }

        async function generateZip() {
            console.log('generateZip called');
            
            if (!window.JSZip) {
                updateStatus("❌ JSZip library not loaded. Please refresh the page.");
                return;
            }

            const zip = new JSZip();
            let fileCount = 0;
            let processedFiles = 0;

            // Count files with content
            for (const filePath in fileInputs) {
                if (fileInputs[filePath].element.value.trim()) {
                    fileCount++;
                }
            }

            if (fileCount === 0) {
                updateStatus("❌ No files with content to process! Please add some code first.");
                return;
            }

            showProgress();
            updateStatus("🔄 Building WordPress theme...");

            // Generate style.css header automatically
            const themeName = document.getElementById('themeName').value || 'Custom Theme';
            const themeVersion = document.getElementById('themeVersion').value || '1.0.0';
            const themeAuthor = document.getElementById('themeAuthor').value || 'Developer';
            const themeDescription = document.getElementById('themeDescription').value || 'A custom WordPress theme';

            const styleHeader = `/*
Theme Name: ${themeName}
Description: ${themeDescription}
Version: ${themeVersion}
Author: ${themeAuthor}
Text Domain: ${themeName.toLowerCase().replace(/[^a-z0-9]/g, '-')}
*/

`;

            try {
                // Process each file
                for (const filePath in fileInputs) {
                    const fileData = fileInputs[filePath];
                    let content = fileData.element.value.trim();
                    
                    if (content) {
                        // Add WordPress header to style.css if it doesn't exist
                        if (filePath === 'style.css' && !content.includes('Theme Name:')) {
                            content = styleHeader + content;
                        }

                        // Organize files properly
                        const pathParts = filePath.split('/');
                        let targetZip = zip;

                        // Create folder structure
                        for (let i = 0; i < pathParts.length - 1; i++) {
                            targetZip = targetZip.folder(pathParts[i]);
                        }
                        
                        // Add the file
                        targetZip.file(pathParts[pathParts.length - 1], content);
                        
                        processedFiles++;
                        updateProgress((processedFiles / fileCount) * 100);
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }

                updateStatus("📦 Generating ZIP file...");
                
                const content = await zip.generateAsync({ 
                    type: "blob",
                    compression: "DEFLATE",
                    compressionOptions: { level: 6 }
                });
                
                const fileName = (themeName || 'wordpress-theme').toLowerCase().replace(/[^a-z0-9]/g, '-');
                
                // Create and trigger download
                const link = document.createElement("a");
                link.href = URL.createObjectURL(content);
                link.download = `${fileName}.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateStatus(`🎉 Successfully created ${fileName}.zip with ${processedFiles} files!`);
                setTimeout(() => hideProgress(), 3000);
                
            } catch (error) {
                console.error('Error generating ZIP:', error);
                updateStatus("❌ Error generating ZIP: " + error.message);
                hideProgress();
            }
        }

        function clearAll() {
            if (confirm("🗑️ Are you sure you want to clear all content?")) {
                document.getElementById('themeStructure').value = '';
                document.getElementById('pluginStructure').value = '';
                document.getElementById('fileGrid').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;">
                        <h3>📄 No files generated yet</h3>
                        <p>Click "Parse Structure & Generate" to create file editors</p>
                    </div>
                `;
                document.getElementById('parsedStructure').textContent = 'Click "Parse Structure & Generate" to see parsed files here...';
                fileInputs = {};
                parsedFiles = [];
                updateStats();
                updateStatus("✨ All content cleared");
            }
        }

        function updateStatus(message) {
            console.log('Status:', message);
            document.getElementById('status').textContent = message;
        }

        function showProgress() {
            document.getElementById('progress').style.display = 'block';
        }

        function hideProgress() {
            document.getElementById('progress').style.display = 'none';
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Auto-parse structure when it changes
        document.getElementById('themeStructure').addEventListener('input', function() {
            if (this.value.trim()) {
                clearTimeout(this.parseTimeout);
                this.parseTimeout = setTimeout(() => {
                    previewStructure();
                }, 1000);
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            updateStats();
            updateStatus("🚀 Ready to build your WordPress theme!");
            
            // Test if JSZip is loaded
            if (window.JSZip) {
                console.log('JSZip loaded successfully');
            } else {
                console.error('JSZip not loaded');
                updateStatus("⚠️ Loading required libraries...");
            }
        });

        // Backup initialization
        window.addEventListener('load', function() {
            console.log('Window load event fired');
            updateStats();
        });
    </script>
</body>
</html>
